packages:
  yum:
    git: []

files: 
  /etc/nginx/conf.d/realtime.conf: 
    content: |-
        upstream backend{
        server localhost:3000;
        }
        
        upstream io_nodes {
        ip_hash;
        server localhost:3000;
        }
        
        server {
        #listen       8081;
        #server_name  localhost;
        #root         html;
        #index        index.php index.html;                  
        
        location /realtime/ {
          proxy_pass http://backend/;
        }
        
        #location / {
        #  proxy_pass http://127.0.0.1:8080;
        #}
        
        location /socket.io/ {
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "upgrade";
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header Host $host;
          proxy_http_version 1.1;
          proxy_pass http://io_nodes;
        }
        
        #error_page   500 502 503 504  /50x.html;
        #    location = /50x.html {
        #        root   html;
        #    }
        }